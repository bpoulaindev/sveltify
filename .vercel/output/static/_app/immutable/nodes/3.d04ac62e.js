import{s as ue,c as R,e as se,d as me,u as he,g as _e,f as ge,h as re,o as ke,i as ne}from"../chunks/scheduler.cd2d310a.js";import{S as de,i as pe,r as W,u as X,v as Y,d as v,t as $,w as Z,g as h,s as j,h as _,j as k,c as I,f as u,k as f,a as L,y as c,b as ae,m as N,n as V,o as A,p as le}from"../chunks/index.bc6dd192.js";import{b as ve,c as be,a as oe,u as xe,e as ie,f as Te,g as $e}from"../chunks/hooks.client.4ad73e98.js";import{L as we}from"../chunks/loader.72a6426c.js";import{d as G}from"../chunks/dayjs.min.5433e12a.js";import{I as ye,g as Se,a as Ee}from"../chunks/Icon.f4a72c78.js";function Oe(l){let s;const n=l[2].default,r=me(n,l,l[3],null);return{c(){r&&r.c()},l(t){r&&r.l(t)},m(t,e){r&&r.m(t,e),s=!0},p(t,e){r&&r.p&&(!s||e&8)&&he(r,n,t,t[3],s?ge(n,t[3],e,null):_e(t[3]),null)},i(t){s||(v(r,t),s=!0)},o(t){$(r,t),s=!1},d(t){r&&r.d(t)}}}function Pe(l){let s,n;const r=[{name:"external-link"},l[1],{iconNode:l[0]}];let t={$$slots:{default:[Oe]},$$scope:{ctx:l}};for(let e=0;e<r.length;e+=1)t=R(t,r[e]);return s=new ye({props:t}),{c(){W(s.$$.fragment)},l(e){X(s.$$.fragment,e)},m(e,a){Y(s,e,a),n=!0},p(e,[a]){const o=a&3?Se(r,[r[0],a&2&&Ee(e[1]),a&1&&{iconNode:e[0]}]):{};a&8&&(o.$$scope={dirty:a,ctx:e}),s.$set(o)},i(e){n||(v(s.$$.fragment,e),n=!0)},o(e){$(s.$$.fragment,e),n=!1},d(e){Z(s,e)}}}function je(l,s,n){let{$$slots:r={},$$scope:t}=s;const e=[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}],["polyline",{points:"15 3 21 3 21 9"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3"}]];return l.$$set=a=>{n(1,s=R(R({},s),se(a))),"$$scope"in a&&n(3,t=a.$$scope)},s=se(s),[e,s,r,t]}class Ie extends de{constructor(s){super(),pe(this,s,je,Pe,ue,{})}}const Ne=Ie;function ce(l){let s,n,r;return n=new we({}),{c(){s=h("div"),W(n.$$.fragment),this.h()},l(t){s=_(t,"DIV",{class:!0});var e=k(s);X(n.$$.fragment,e),e.forEach(u),this.h()},h(){f(s,"class","flex flex-col items-center")},m(t,e){L(t,s,e),Y(n,s,null),r=!0},i(t){r||(v(n.$$.fragment,t),r=!0)},o(t){$(n.$$.fragment,t),r=!1},d(t){t&&u(s),Z(n)}}}function fe(l){let s,n,r,t,e,a,o,T=l[0].display_name+"",w,d,p,y,E,b,C,O,D=l[0].country+"",J,B,S,z=l[0].followers.total+"",M,K,x;p=new Ne({props:{class:"h-2 w-2 ml-1"}});function ee(i,m){return i[0].product==="premium"?De:Ve}let q=ee(l),g=q(l);return{c(){s=h("div"),n=h("div"),r=h("img"),e=j(),a=h("div"),o=h("a"),w=N(T),d=j(),W(p.$$.fragment),E=j(),b=h("div"),g.c(),C=j(),O=h("span"),J=N(D),B=j(),S=h("h5"),M=N(z),K=N(`
                        Followers`),this.h()},l(i){s=_(i,"DIV",{class:!0});var m=k(s);n=_(m,"DIV",{class:!0});var F=k(n);r=_(F,"IMG",{src:!0,alt:!0,class:!0}),e=I(F),a=_(F,"DIV",{class:!0});var P=k(a);o=_(P,"A",{href:!0,target:!0,title:!0,class:!0});var H=k(o);w=V(H,T),d=I(H),X(p.$$.fragment,H),H.forEach(u),E=I(P),b=_(P,"DIV",{class:!0});var U=k(b);g.l(U),C=I(U),O=_(U,"SPAN",{class:!0});var te=k(O);J=V(te,D),te.forEach(u),U.forEach(u),B=I(P),S=_(P,"H5",{class:!0});var Q=k(S);M=V(Q,z),K=V(Q,`
                        Followers`),Q.forEach(u),P.forEach(u),F.forEach(u),m.forEach(u),this.h()},h(){ne(r.src,t=l[0].images[1].url)||f(r,"src",t),f(r,"alt","profile"),f(r,"class","rounded-lg w-10 h-10 min-h-10 min-w-10 object-cover bg-center ring-2 ring-indigo-300 dark:ring-slate-700"),f(o,"href",y=l[0].external_urls.spotify),f(o,"target","_blank"),f(o,"title","Open Spotify profile"),f(o,"class","group text-2xl flex items-center font-bold dark:text-white hover:text-indigo-500 dark:hover:text-indigo-300 ease-in duration-100"),f(O,"class","ml-1 inline-flex capitalize items-center rounded-md bg-slate-50 px-1 py-0.5 text-xs font-medium text-slate-700 ring-1 ring-inset ring-slate-600/10 dark:ring-2 dark:bg-slate-400/10 dark:text-slate-400 dark:ring-slate-400/20"),f(b,"class","flex items-center mt-0.5"),f(S,"class","text-xs mt-1 font-semibold dark:text-slate-500"),f(a,"class","flex flex-col ml-2"),f(n,"class","flex items-center px-2 h-14 rounded-2xl bg-white dark:bg-slate-900 border-2 border-slate-300 dark:border-slate-800"),f(s,"class","flex items-center w-full justify-center")},m(i,m){L(i,s,m),c(s,n),c(n,r),c(n,e),c(n,a),c(a,o),c(o,w),c(o,d),Y(p,o,null),c(a,E),c(a,b),g.m(b,null),c(b,C),c(b,O),c(O,J),c(a,B),c(a,S),c(S,M),c(S,K),x=!0},p(i,m){(!x||m&1&&!ne(r.src,t=i[0].images[1].url))&&f(r,"src",t),(!x||m&1)&&T!==(T=i[0].display_name+"")&&A(w,T),(!x||m&1&&y!==(y=i[0].external_urls.spotify))&&f(o,"href",y),q===(q=ee(i))&&g?g.p(i,m):(g.d(1),g=q(i),g&&(g.c(),g.m(b,C))),(!x||m&1)&&D!==(D=i[0].country+"")&&A(J,D),(!x||m&1)&&z!==(z=i[0].followers.total+"")&&A(M,z)},i(i){x||(v(p.$$.fragment,i),x=!0)},o(i){$(p.$$.fragment,i),x=!1},d(i){i&&u(s),Z(p),g.d()}}}function Ve(l){let s,n=l[0].product+"",r;return{c(){s=h("span"),r=N(n),this.h()},l(t){s=_(t,"SPAN",{class:!0});var e=k(s);r=V(e,n),e.forEach(u),this.h()},h(){f(s,"class","inline-flex capitalize items-center rounded-md bg-green-50 px-1 py-0.5 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/10 dark:ring-2 dark:bg-green-400/10 dark:text-green-400 dark:ring-green-400/20")},m(t,e){L(t,s,e),c(s,r)},p(t,e){e&1&&n!==(n=t[0].product+"")&&A(r,n)},d(t){t&&u(s)}}}function De(l){let s,n=l[0].product+"",r;return{c(){s=h("span"),r=N(n),this.h()},l(t){s=_(t,"SPAN",{class:!0});var e=k(s);r=V(e,n),e.forEach(u),this.h()},h(){f(s,"class","inline-flex capitalize items-center rounded-md bg-purple-50 px-1 py-0.5 text-xs font-medium text-purple-700 ring-1 ring-inset ring-purple-600/10 dark:ring-2 dark:bg-red-400/10 dark:text-red-400 dark:ring-red-400/20")},m(t,e){L(t,s,e),c(s,r)},p(t,e){e&1&&n!==(n=t[0].product+"")&&A(r,n)},d(t){t&&u(s)}}}function ze(l){let s,n,r,t=!l[0]&&ce(),e=l[0]&&fe(l);return{c(){s=h("div"),t&&t.c(),n=j(),e&&e.c(),this.h()},l(a){s=_(a,"DIV",{class:!0});var o=k(s);t&&t.l(o),n=I(o),e&&e.l(o),o.forEach(u),this.h()},h(){f(s,"class","flex w-full flex-col mt-1")},m(a,o){L(a,s,o),t&&t.m(s,null),c(s,n),e&&e.m(s,null),r=!0},p(a,[o]){a[0]?t&&(le(),$(t,1,1,()=>{t=null}),ae()):t?o&1&&v(t,1):(t=ce(),t.c(),v(t,1),t.m(s,n)),a[0]?e?(e.p(a,o),o&1&&v(e,1)):(e=fe(a),e.c(),v(e,1),e.m(s,null)):e&&(le(),$(e,1,1,()=>{e=null}),ae())},i(a){r||(v(t),v(e),r=!0)},o(a){$(t),$(e),r=!1},d(a){a&&u(s),t&&t.d(),e&&e.d()}}}function Ae(l,s,n){let r,t;return re(l,ie,e=>n(0,r=e)),re(l,oe,e=>n(1,t=e)),ke(async()=>{var a,o,T,w;ve(),be(),(!t||!t.accessToken||!t.refreshToken)&&(window.location.href="/login");const e=t;if(G().valueOf()-(((a=e==null?void 0:e.refreshToken)==null?void 0:a.timestamp)??0)>36e5){const d=await fetch("/api/spotify/refresh",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:JSON.stringify({refreshToken:((o=e==null?void 0:e.refreshToken)==null?void 0:o.token)||""})}).then(p=>p.json()).then(p=>{const y=G().valueOf(),E={accessToken:{token:p.accessToken,timestamp:y},refreshToken:{token:p.refreshToken,timestamp:y}};return oe.set(E),xe(E),p.accessToken});e&&e.accessToken&&e.accessToken.token&&(e.accessToken.token=d)}r&&r.timestamp<G().valueOf()-36e5||(await fetch("/api/spotify/profile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:((T=e==null?void 0:e.accessToken)==null?void 0:T.token)||""})}).then(d=>d.json()).then(d=>{ie.set({...d,timestamp:G().valueOf()}),Te(d)}),await fetch("/api/spotify/artists",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:JSON.stringify({accessToken:((w=e==null?void 0:e.accessToken)==null?void 0:w.token)||""})}).then(d=>d.json()).then(d=>{console.log("pitié pitié",d),$e.set(d)}))}),[r]}class He extends de{constructor(s){super(),pe(this,s,Ae,ze,ue,{})}}export{He as component};
