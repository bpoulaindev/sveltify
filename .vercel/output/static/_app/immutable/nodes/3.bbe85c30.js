import{s as ue,c as R,e as re,d as me,u as he,g as _e,f as ge,h as se,o as ke,i as ae}from"../chunks/scheduler.cd2d310a.js";import{S as de,i as pe,r as W,u as X,v as Y,d as g,t as x,w as Z,g as p,s as S,h as m,j as _,c as E,f as u,k as f,a as V,y as c,b as ne,m as O,n as P,o as N,p as le}from"../chunks/index.bc6dd192.js";import{b as ve,c as be,a as oe,u as xe,e as ie,f as $e,g as ye}from"../chunks/hooks.client.46f5bdbb.js";import{L as we}from"../chunks/loader.72a6426c.js";import{d as H}from"../chunks/dayjs.min.a35c91f3.js";import{I as Te,g as Se,a as Ee}from"../chunks/Icon.f4a72c78.js";function Oe(l){let r;const n=l[2].default,s=me(n,l,l[3],null);return{c(){s&&s.c()},l(t){s&&s.l(t)},m(t,e){s&&s.m(t,e),r=!0},p(t,e){s&&s.p&&(!r||e&8)&&he(s,n,t,t[3],r?ge(n,t[3],e,null):_e(t[3]),null)},i(t){r||(g(s,t),r=!0)},o(t){x(s,t),r=!1},d(t){s&&s.d(t)}}}function Pe(l){let r,n;const s=[{name:"external-link"},l[1],{iconNode:l[0]}];let t={$$slots:{default:[Oe]},$$scope:{ctx:l}};for(let e=0;e<s.length;e+=1)t=R(t,s[e]);return r=new Te({props:t}),{c(){W(r.$$.fragment)},l(e){X(r.$$.fragment,e)},m(e,a){Y(r,e,a),n=!0},p(e,[a]){const o=a&3?Se(s,[s[0],a&2&&Ee(e[1]),a&1&&{iconNode:e[0]}]):{};a&8&&(o.$$scope={dirty:a,ctx:e}),r.$set(o)},i(e){n||(g(r.$$.fragment,e),n=!0)},o(e){x(r.$$.fragment,e),n=!1},d(e){Z(r,e)}}}function je(l,r,n){let{$$slots:s={},$$scope:t}=r;const e=[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}],["polyline",{points:"15 3 21 3 21 9"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3"}]];return l.$$set=a=>{n(1,r=R(R({},r),re(a))),"$$scope"in a&&n(3,t=a.$$scope)},r=re(r),[e,r,s,t]}class Ie extends de{constructor(r){super(),pe(this,r,je,Pe,ue,{})}}const Ne=Ie;function ce(l){let r,n,s;return n=new we({}),{c(){r=p("div"),W(n.$$.fragment),this.h()},l(t){r=m(t,"DIV",{class:!0});var e=_(r);X(n.$$.fragment,e),e.forEach(u),this.h()},h(){f(r,"class","flex flex-col items-center")},m(t,e){V(t,r,e),Y(n,r,null),s=!0},i(t){s||(g(n.$$.fragment,t),s=!0)},o(t){x(n.$$.fragment,t),s=!1},d(t){t&&u(r),Z(n)}}}function fe(l){let r,n,s,t,e,a,o,b=l[0].display_name+"",D,U,$,z,G,k,L,w,j=l[0].country+"",A,B,y,I=l[0].followers.total+"",C,K,v;$=new Ne({props:{class:"h-2 w-2 ml-1"}});function ee(i,d){return i[0].product==="premium"?De:Ve}let J=ee(l),h=J(l);return{c(){r=p("div"),n=p("div"),s=p("img"),e=S(),a=p("div"),o=p("a"),D=O(b),U=S(),W($.$$.fragment),G=S(),k=p("div"),h.c(),L=S(),w=p("span"),A=O(j),B=S(),y=p("h5"),C=O(I),K=O(`
                        Followers`),this.h()},l(i){r=m(i,"DIV",{class:!0});var d=_(r);n=m(d,"DIV",{class:!0});var M=_(n);s=m(M,"IMG",{src:!0,alt:!0,class:!0}),e=E(M),a=m(M,"DIV",{class:!0});var T=_(a);o=m(T,"A",{href:!0,target:!0,title:!0,class:!0});var q=_(o);D=P(q,b),U=E(q),X($.$$.fragment,q),q.forEach(u),G=E(T),k=m(T,"DIV",{class:!0});var F=_(k);h.l(F),L=E(F),w=m(F,"SPAN",{class:!0});var te=_(w);A=P(te,j),te.forEach(u),F.forEach(u),B=E(T),y=m(T,"H5",{class:!0});var Q=_(y);C=P(Q,I),K=P(Q,`
                        Followers`),Q.forEach(u),T.forEach(u),M.forEach(u),d.forEach(u),this.h()},h(){ae(s.src,t=l[0].images[1].url)||f(s,"src",t),f(s,"alt","profile"),f(s,"class","rounded-lg w-10 h-10 min-h-10 min-w-10 object-cover bg-center ring-2 ring-indigo-300 dark:ring-slate-700"),f(o,"href",z=l[0].external_urls.spotify),f(o,"target","_blank"),f(o,"title","Open Spotify profile"),f(o,"class","group text-2xl flex items-center font-bold dark:text-white hover:text-indigo-500 dark:hover:text-indigo-300 ease-in duration-100"),f(w,"class","ml-1 inline-flex capitalize items-center rounded-md bg-slate-50 px-1 py-0.5 text-xs font-medium text-slate-700 ring-1 ring-inset ring-slate-600/10 dark:ring-2 dark:bg-slate-400/10 dark:text-slate-400 dark:ring-slate-400/20"),f(k,"class","flex items-center mt-0.5"),f(y,"class","text-xs mt-1 font-semibold dark:text-slate-500"),f(a,"class","flex flex-col ml-2"),f(n,"class","flex items-center px-2 h-14 rounded-2xl bg-white dark:bg-slate-900 border-2 border-slate-300 dark:border-slate-800"),f(r,"class","flex items-center w-full justify-center")},m(i,d){V(i,r,d),c(r,n),c(n,s),c(n,e),c(n,a),c(a,o),c(o,D),c(o,U),Y($,o,null),c(a,G),c(a,k),h.m(k,null),c(k,L),c(k,w),c(w,A),c(a,B),c(a,y),c(y,C),c(y,K),v=!0},p(i,d){(!v||d&1&&!ae(s.src,t=i[0].images[1].url))&&f(s,"src",t),(!v||d&1)&&b!==(b=i[0].display_name+"")&&N(D,b),(!v||d&1&&z!==(z=i[0].external_urls.spotify))&&f(o,"href",z),J===(J=ee(i))&&h?h.p(i,d):(h.d(1),h=J(i),h&&(h.c(),h.m(k,L))),(!v||d&1)&&j!==(j=i[0].country+"")&&N(A,j),(!v||d&1)&&I!==(I=i[0].followers.total+"")&&N(C,I)},i(i){v||(g($.$$.fragment,i),v=!0)},o(i){x($.$$.fragment,i),v=!1},d(i){i&&u(r),Z($),h.d()}}}function Ve(l){let r,n=l[0].product+"",s;return{c(){r=p("span"),s=O(n),this.h()},l(t){r=m(t,"SPAN",{class:!0});var e=_(r);s=P(e,n),e.forEach(u),this.h()},h(){f(r,"class","inline-flex capitalize items-center rounded-md bg-green-50 px-1 py-0.5 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/10 dark:ring-2 dark:bg-green-400/10 dark:text-green-400 dark:ring-green-400/20")},m(t,e){V(t,r,e),c(r,s)},p(t,e){e&1&&n!==(n=t[0].product+"")&&N(s,n)},d(t){t&&u(r)}}}function De(l){let r,n=l[0].product+"",s;return{c(){r=p("span"),s=O(n),this.h()},l(t){r=m(t,"SPAN",{class:!0});var e=_(r);s=P(e,n),e.forEach(u),this.h()},h(){f(r,"class","inline-flex capitalize items-center rounded-md bg-purple-50 px-1 py-0.5 text-xs font-medium text-purple-700 ring-1 ring-inset ring-purple-600/10 dark:ring-2 dark:bg-red-400/10 dark:text-red-400 dark:ring-red-400/20")},m(t,e){V(t,r,e),c(r,s)},p(t,e){e&1&&n!==(n=t[0].product+"")&&N(s,n)},d(t){t&&u(r)}}}function ze(l){let r,n,s,t=!l[0]&&ce(),e=l[0]&&fe(l);return{c(){r=p("div"),t&&t.c(),n=S(),e&&e.c(),this.h()},l(a){r=m(a,"DIV",{class:!0});var o=_(r);t&&t.l(o),n=E(o),e&&e.l(o),o.forEach(u),this.h()},h(){f(r,"class","flex w-full flex-col mt-1")},m(a,o){V(a,r,o),t&&t.m(r,null),c(r,n),e&&e.m(r,null),s=!0},p(a,[o]){a[0]?t&&(le(),x(t,1,1,()=>{t=null}),ne()):t?o&1&&g(t,1):(t=ce(),t.c(),g(t,1),t.m(r,n)),a[0]?e?(e.p(a,o),o&1&&g(e,1)):(e=fe(a),e.c(),g(e,1),e.m(r,null)):e&&(le(),x(e,1,1,()=>{e=null}),ne())},i(a){s||(g(t),g(e),s=!0)},o(a){x(t),x(e),s=!1},d(a){a&&u(r),t&&t.d(),e&&e.d()}}}function Le(l,r,n){let s,t;return se(l,ie,e=>n(0,s=e)),se(l,oe,e=>n(1,t=e)),ke(async()=>{ve(),be(),(!t||!t.accessToken||!t.refreshToken)&&(window.location.href="/login");const e=t;H().valueOf()-(e==null?void 0:e.refreshToken.timestamp)>36e5&&(e.accessToken.token=await fetch("/api/spotify/refresh",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:JSON.stringify({refreshToken:e.refreshToken.token})}).then(a=>a.json()).then(a=>{const o=H().valueOf(),b={accessToken:{token:a.accessToken,timestamp:o},refreshToken:{token:a.refreshToken,timestamp:o}};return oe.set(b),xe(b),a.accessToken})),!(s&&s.timestamp<H().valueOf()-36e5)&&(await fetch("/api/spotify/profile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:e==null?void 0:e.accessToken.token})}).then(a=>a.json()).then(a=>{ie.set({...a,timestamp:H().valueOf()}),$e(a)}),await fetch("/api/spotify/artists",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:JSON.stringify({accessToken:e==null?void 0:e.accessToken.token})}).then(a=>a.json()).then(a=>{console.log("pitié pitié",a),ye.set(a)}))}),[s]}class He extends de{constructor(r){super(),pe(this,r,Le,ze,ue,{})}}export{He as component};
